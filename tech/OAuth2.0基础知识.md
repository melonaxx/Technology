四种授权许可类型

场景一：

用户通过微信方式登录第一方应用，这其中有三个角色；

- 用户（资源拥有者）
- 第三方软件APP（第三方应用）
- 第三方软件服务端（第三方应用服务）
- 资源授权服务器（受保护的资源授权方）
- 资源服务器（受保护资源提供方）



**授权方式：**

- 授权码许可类型：（authorization-code 授权码）

  多应用于三方（用户、百度、微信）各自都不相互信任时的场景；适用于一切有服务端的Web应用；

  ```shell
  # 第一步：第三方应用网站提供一个链接 -----> 当用户点击后会跳转到资源授权服务器提供的页面（展示出用户是否同意授权）
  # 第二步：用用户同意授权后跳转到第三方应用网站指定的重定向地址，同时会带上授权码 ------> 第三方应用网站获得授权码
  # 第三步：第三方应用服务端通过授权码向资源授权服务器发起请求索取token -----> 资源授权服务器响应返回token到第三方应用服务端指定的地址
  # 第四步：第三方应用服务端通过令牌向资源服务器获取数据
  ```

  

- 隐式许可类型：（implicit 隐藏式）

  第三方软件运行在浏览器中的应用；一般应用在没有服务端的应用中，把token直接发给客户端（纯前端没有后端）

  这种把令牌直接放在客户端的方式很不安全，一般用在对安全性要求不高的场景中，并且令牌的有效期非常短。

  ```shell
  # 第一步：第三方应用网站提供一个链接 -----> 当用户点击后会跳转到资源授权服务器提供的页面（展示出用户是否同意授权）
  # 第二步：用用户同意授权后跳转到第三方应用网站指定的重定向地址，同时会带上token ------> 第三方应用网站获得token
  # 第三步：第三方应用服务端通过令牌向资源服务器获取数据
  ```

  

- 资源拥有者凭据许可类型：（password 密码式）

  适用于信任度极高的软件应用；用户把账号密码直接告诉第三方应用，第三方应用就使用账号密码申请token;

  ```shell
  # 第一步：用户--> 在第三方应用输入账号密码(资源方的) ---> 到第三方服务端拿账号密码向资源授权服务器索取token
  
  # 第二步：资源授权服务器返回token给第三方服务器 ----> 第三方服务器拿token去资源服务器获取数据
  ```

- 客户端凭据许可类型：（client-credentiails 客户端凭证）

  适用于应用程序直接访问资源的场景，一般适用于没有前端的命令行应用（在命令行下请求令牌）

  这种方式给出的令牌是针对第三方应用的，而不是针对用户的，即存在多个用户共享同一个令牌。

  ```shell
  # 第一步：第三方应用在命令行下向资源授权服务器发起请求 -----> 资源授权服务器验证通过后响应返回token
  # 第二步：第三方应用服务端通过令牌向资源服务器获取数据
  ```

**令牌的使用方式：**

第三方应用服务端通过令牌向资源服务器开放的API获取数据，具体做法是在请求头信息中添加一个`Authorization`字段

```shell
curl -H 'Authorization: bearer ACCESS_TOKEN' https://api.other.com
# 其中 ACCESS_TOKNE就是令牌
```

**更新令牌：**

令牌到期后如果让用户再申请一个令牌体验非常不好，OAuth2.0允许用户自动更新令牌。资源授权服务器在颁发令牌时一次性颁发了两个令牌，一个是令牌，另一个是刷新令牌的令牌。

```shell
# 第一步：第三方应用在命令行下向资源授权服务器发起请求刷新令牌 -----> 资源授权服务器验证通过后响应返回新的token
# 第二步：第三方应用服务端通过刷新后的令牌向资源服务器获取数据
```

